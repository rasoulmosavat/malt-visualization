{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _roundRobinArrayIndex = _interopRequireDefault(require(\"./round-robin-array-index\"));\n\nvar _loadBalancingStrategy = _interopRequireDefault(require(\"./load-balancing-strategy\"));\n/**\n * Copyright (c) 2002-2020 \"Neo4j,\"\n * Neo4j Sweden AB [http://neo4j.com]\n *\n * This file is part of Neo4j.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nvar LeastConnectedLoadBalancingStrategy = /*#__PURE__*/function (_LoadBalancingStrateg) {\n  (0, _inherits2[\"default\"])(LeastConnectedLoadBalancingStrategy, _LoadBalancingStrateg);\n  /**\n   * @constructor\n   * @param {Pool} connectionPool the connection pool of this driver.\n   */\n\n  function LeastConnectedLoadBalancingStrategy(connectionPool) {\n    var _this;\n\n    (0, _classCallCheck2[\"default\"])(this, LeastConnectedLoadBalancingStrategy);\n    _this = (0, _possibleConstructorReturn2[\"default\"])(this, (0, _getPrototypeOf2[\"default\"])(LeastConnectedLoadBalancingStrategy).call(this));\n    _this._readersIndex = new _roundRobinArrayIndex[\"default\"]();\n    _this._writersIndex = new _roundRobinArrayIndex[\"default\"]();\n    _this._connectionPool = connectionPool;\n    return _this;\n  }\n  /**\n   * @inheritDoc\n   */\n\n\n  (0, _createClass2[\"default\"])(LeastConnectedLoadBalancingStrategy, [{\n    key: \"selectReader\",\n    value: function selectReader(knownReaders) {\n      return this._select(knownReaders, this._readersIndex);\n    }\n    /**\n     * @inheritDoc\n     */\n\n  }, {\n    key: \"selectWriter\",\n    value: function selectWriter(knownWriters) {\n      return this._select(knownWriters, this._writersIndex);\n    }\n  }, {\n    key: \"_select\",\n    value: function _select(addresses, roundRobinIndex) {\n      var length = addresses.length;\n\n      if (length === 0) {\n        return null;\n      } // choose start index for iteration in round-robin fashion\n\n\n      var startIndex = roundRobinIndex.next(length);\n      var index = startIndex;\n      var leastConnectedAddress = null;\n      var leastActiveConnections = Number.MAX_SAFE_INTEGER; // iterate over the array to find least connected address\n\n      do {\n        var address = addresses[index];\n\n        var activeConnections = this._connectionPool.activeResourceCount(address);\n\n        if (activeConnections < leastActiveConnections) {\n          leastConnectedAddress = address;\n          leastActiveConnections = activeConnections;\n        } // loop over to the start of the array when end is reached\n\n\n        if (index === length - 1) {\n          index = 0;\n        } else {\n          index++;\n        }\n      } while (index !== startIndex);\n\n      return leastConnectedAddress;\n    }\n  }]);\n  return LeastConnectedLoadBalancingStrategy;\n}(_loadBalancingStrategy[\"default\"]);\n\nexports[\"default\"] = LeastConnectedLoadBalancingStrategy;","map":{"version":3,"sources":["d:/webback/pro5/node_modules/neo4j-driver/lib/internal/least-connected-load-balancing-strategy.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","_classCallCheck2","_createClass2","_possibleConstructorReturn2","_getPrototypeOf2","_inherits2","_roundRobinArrayIndex","_loadBalancingStrategy","LeastConnectedLoadBalancingStrategy","_LoadBalancingStrateg","connectionPool","_this","call","_readersIndex","_writersIndex","_connectionPool","key","selectReader","knownReaders","_select","selectWriter","knownWriters","addresses","roundRobinIndex","length","startIndex","next","index","leastConnectedAddress","leastActiveConnections","Number","MAX_SAFE_INTEGER","address","activeConnections","activeResourceCount"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _roundRobinArrayIndex = _interopRequireDefault(require(\"./round-robin-array-index\"));\n\nvar _loadBalancingStrategy = _interopRequireDefault(require(\"./load-balancing-strategy\"));\n\n/**\n * Copyright (c) 2002-2020 \"Neo4j,\"\n * Neo4j Sweden AB [http://neo4j.com]\n *\n * This file is part of Neo4j.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar LeastConnectedLoadBalancingStrategy =\n/*#__PURE__*/\nfunction (_LoadBalancingStrateg) {\n  (0, _inherits2[\"default\"])(LeastConnectedLoadBalancingStrategy, _LoadBalancingStrateg);\n\n  /**\n   * @constructor\n   * @param {Pool} connectionPool the connection pool of this driver.\n   */\n  function LeastConnectedLoadBalancingStrategy(connectionPool) {\n    var _this;\n\n    (0, _classCallCheck2[\"default\"])(this, LeastConnectedLoadBalancingStrategy);\n    _this = (0, _possibleConstructorReturn2[\"default\"])(this, (0, _getPrototypeOf2[\"default\"])(LeastConnectedLoadBalancingStrategy).call(this));\n    _this._readersIndex = new _roundRobinArrayIndex[\"default\"]();\n    _this._writersIndex = new _roundRobinArrayIndex[\"default\"]();\n    _this._connectionPool = connectionPool;\n    return _this;\n  }\n  /**\n   * @inheritDoc\n   */\n\n\n  (0, _createClass2[\"default\"])(LeastConnectedLoadBalancingStrategy, [{\n    key: \"selectReader\",\n    value: function selectReader(knownReaders) {\n      return this._select(knownReaders, this._readersIndex);\n    }\n    /**\n     * @inheritDoc\n     */\n\n  }, {\n    key: \"selectWriter\",\n    value: function selectWriter(knownWriters) {\n      return this._select(knownWriters, this._writersIndex);\n    }\n  }, {\n    key: \"_select\",\n    value: function _select(addresses, roundRobinIndex) {\n      var length = addresses.length;\n\n      if (length === 0) {\n        return null;\n      } // choose start index for iteration in round-robin fashion\n\n\n      var startIndex = roundRobinIndex.next(length);\n      var index = startIndex;\n      var leastConnectedAddress = null;\n      var leastActiveConnections = Number.MAX_SAFE_INTEGER; // iterate over the array to find least connected address\n\n      do {\n        var address = addresses[index];\n\n        var activeConnections = this._connectionPool.activeResourceCount(address);\n\n        if (activeConnections < leastActiveConnections) {\n          leastConnectedAddress = address;\n          leastActiveConnections = activeConnections;\n        } // loop over to the start of the array when end is reached\n\n\n        if (index === length - 1) {\n          index = 0;\n        } else {\n          index++;\n        }\n      } while (index !== startIndex);\n\n      return leastConnectedAddress;\n    }\n  }]);\n  return LeastConnectedLoadBalancingStrategy;\n}(_loadBalancingStrategy[\"default\"]);\n\nexports[\"default\"] = LeastConnectedLoadBalancingStrategy;"]},"metadata":{},"sourceType":"script"}