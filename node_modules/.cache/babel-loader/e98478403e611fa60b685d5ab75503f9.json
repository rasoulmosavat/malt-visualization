{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _node = require(\"./node\");\n\nvar _error = require(\"../error\");\n\nvar _boltProtocolV = _interopRequireDefault(require(\"./bolt-protocol-v1\"));\n\nvar _boltProtocolV2 = _interopRequireDefault(require(\"./bolt-protocol-v2\"));\n\nvar _boltProtocolV3 = _interopRequireDefault(require(\"./bolt-protocol-v3\"));\n\nvar _boltProtocolV4 = _interopRequireDefault(require(\"./bolt-protocol-v4\"));\n/**\n * Copyright (c) 2002-2020 \"Neo4j,\"\n * Neo4j Sweden AB [http://neo4j.com]\n *\n * This file is part of Neo4j.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nvar HTTP_MAGIC_PREAMBLE = 1213486160; // == 0x48545450 == \"HTTP\"\n\nvar BOLT_MAGIC_PREAMBLE = 0x6060b017;\n\nvar ProtocolHandshaker = /*#__PURE__*/function () {\n  /**\n   * @constructor\n   * @param {Connection} connection the connection owning this protocol.\n   * @param {Channel} channel the network channel.\n   * @param {Chunker} chunker the message chunker.\n   * @param {boolean} disableLosslessIntegers flag to use native JS numbers.\n   * @param {Logger} log the logger.\n   */\n  function ProtocolHandshaker(connection, channel, chunker, disableLosslessIntegers, log) {\n    (0, _classCallCheck2[\"default\"])(this, ProtocolHandshaker);\n    this._connection = connection;\n    this._channel = channel;\n    this._chunker = chunker;\n    this._disableLosslessIntegers = disableLosslessIntegers;\n    this._log = log;\n  }\n  /**\n   * Write a Bolt handshake into the underlying network channel.\n   */\n\n\n  (0, _createClass2[\"default\"])(ProtocolHandshaker, [{\n    key: \"writeHandshakeRequest\",\n    value: function writeHandshakeRequest() {\n      this._channel.write(newHandshakeBuffer());\n    }\n    /**\n     * Read the given handshake response and create the negotiated bolt protocol.\n     * @param {BaseBuffer} buffer byte buffer containing the handshake response.\n     * @return {BoltProtocol} bolt protocol corresponding to the version suggested by the database.\n     * @throws {Neo4jError} when bolt protocol can't be instantiated.\n     */\n\n  }, {\n    key: \"createNegotiatedProtocol\",\n    value: function createNegotiatedProtocol(buffer) {\n      var negotiatedVersion = buffer.readInt32();\n\n      if (this._log.isDebugEnabled()) {\n        this._log.debug(\"\".concat(this._connection, \" negotiated protocol version \").concat(negotiatedVersion));\n      }\n\n      return this._createProtocolWithVersion(negotiatedVersion);\n    }\n    /**\n     * @return {BoltProtocol}\n     * @private\n     */\n\n  }, {\n    key: \"_createProtocolWithVersion\",\n    value: function _createProtocolWithVersion(version) {\n      switch (version) {\n        case 1:\n          return new _boltProtocolV[\"default\"](this._connection, this._chunker, this._disableLosslessIntegers);\n\n        case 2:\n          return new _boltProtocolV2[\"default\"](this._connection, this._chunker, this._disableLosslessIntegers);\n\n        case 3:\n          return new _boltProtocolV3[\"default\"](this._connection, this._chunker, this._disableLosslessIntegers);\n\n        case 4:\n          return new _boltProtocolV4[\"default\"](this._connection, this._chunker, this._disableLosslessIntegers);\n\n        case HTTP_MAGIC_PREAMBLE:\n          throw (0, _error.newError)('Server responded HTTP. Make sure you are not trying to connect to the http endpoint ' + '(HTTP defaults to port 7474 whereas BOLT defaults to port 7687)');\n\n        default:\n          throw (0, _error.newError)('Unknown Bolt protocol version: ' + version);\n      }\n    }\n  }]);\n  return ProtocolHandshaker;\n}();\n/**\n * @return {BaseBuffer}\n * @private\n */\n\n\nexports[\"default\"] = ProtocolHandshaker;\n\nfunction newHandshakeBuffer() {\n  var handshakeBuffer = (0, _node.alloc)(5 * 4); // magic preamble\n\n  handshakeBuffer.writeInt32(BOLT_MAGIC_PREAMBLE); // proposed versions\n\n  handshakeBuffer.writeInt32(4);\n  handshakeBuffer.writeInt32(3);\n  handshakeBuffer.writeInt32(2);\n  handshakeBuffer.writeInt32(1); // reset the reader position\n\n  handshakeBuffer.reset();\n  return handshakeBuffer;\n}","map":{"version":3,"sources":["d:/webback/pro5/node_modules/neo4j-driver/lib/internal/protocol-handshaker.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","_classCallCheck2","_createClass2","_node","_error","_boltProtocolV","_boltProtocolV2","_boltProtocolV3","_boltProtocolV4","HTTP_MAGIC_PREAMBLE","BOLT_MAGIC_PREAMBLE","ProtocolHandshaker","connection","channel","chunker","disableLosslessIntegers","log","_connection","_channel","_chunker","_disableLosslessIntegers","_log","key","writeHandshakeRequest","write","newHandshakeBuffer","createNegotiatedProtocol","buffer","negotiatedVersion","readInt32","isDebugEnabled","debug","concat","_createProtocolWithVersion","version","newError","handshakeBuffer","alloc","writeInt32","reset"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _node = require(\"./node\");\n\nvar _error = require(\"../error\");\n\nvar _boltProtocolV = _interopRequireDefault(require(\"./bolt-protocol-v1\"));\n\nvar _boltProtocolV2 = _interopRequireDefault(require(\"./bolt-protocol-v2\"));\n\nvar _boltProtocolV3 = _interopRequireDefault(require(\"./bolt-protocol-v3\"));\n\nvar _boltProtocolV4 = _interopRequireDefault(require(\"./bolt-protocol-v4\"));\n\n/**\n * Copyright (c) 2002-2020 \"Neo4j,\"\n * Neo4j Sweden AB [http://neo4j.com]\n *\n * This file is part of Neo4j.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar HTTP_MAGIC_PREAMBLE = 1213486160; // == 0x48545450 == \"HTTP\"\n\nvar BOLT_MAGIC_PREAMBLE = 0x6060b017;\n\nvar ProtocolHandshaker =\n/*#__PURE__*/\nfunction () {\n  /**\n   * @constructor\n   * @param {Connection} connection the connection owning this protocol.\n   * @param {Channel} channel the network channel.\n   * @param {Chunker} chunker the message chunker.\n   * @param {boolean} disableLosslessIntegers flag to use native JS numbers.\n   * @param {Logger} log the logger.\n   */\n  function ProtocolHandshaker(connection, channel, chunker, disableLosslessIntegers, log) {\n    (0, _classCallCheck2[\"default\"])(this, ProtocolHandshaker);\n    this._connection = connection;\n    this._channel = channel;\n    this._chunker = chunker;\n    this._disableLosslessIntegers = disableLosslessIntegers;\n    this._log = log;\n  }\n  /**\n   * Write a Bolt handshake into the underlying network channel.\n   */\n\n\n  (0, _createClass2[\"default\"])(ProtocolHandshaker, [{\n    key: \"writeHandshakeRequest\",\n    value: function writeHandshakeRequest() {\n      this._channel.write(newHandshakeBuffer());\n    }\n    /**\n     * Read the given handshake response and create the negotiated bolt protocol.\n     * @param {BaseBuffer} buffer byte buffer containing the handshake response.\n     * @return {BoltProtocol} bolt protocol corresponding to the version suggested by the database.\n     * @throws {Neo4jError} when bolt protocol can't be instantiated.\n     */\n\n  }, {\n    key: \"createNegotiatedProtocol\",\n    value: function createNegotiatedProtocol(buffer) {\n      var negotiatedVersion = buffer.readInt32();\n\n      if (this._log.isDebugEnabled()) {\n        this._log.debug(\"\".concat(this._connection, \" negotiated protocol version \").concat(negotiatedVersion));\n      }\n\n      return this._createProtocolWithVersion(negotiatedVersion);\n    }\n    /**\n     * @return {BoltProtocol}\n     * @private\n     */\n\n  }, {\n    key: \"_createProtocolWithVersion\",\n    value: function _createProtocolWithVersion(version) {\n      switch (version) {\n        case 1:\n          return new _boltProtocolV[\"default\"](this._connection, this._chunker, this._disableLosslessIntegers);\n\n        case 2:\n          return new _boltProtocolV2[\"default\"](this._connection, this._chunker, this._disableLosslessIntegers);\n\n        case 3:\n          return new _boltProtocolV3[\"default\"](this._connection, this._chunker, this._disableLosslessIntegers);\n\n        case 4:\n          return new _boltProtocolV4[\"default\"](this._connection, this._chunker, this._disableLosslessIntegers);\n\n        case HTTP_MAGIC_PREAMBLE:\n          throw (0, _error.newError)('Server responded HTTP. Make sure you are not trying to connect to the http endpoint ' + '(HTTP defaults to port 7474 whereas BOLT defaults to port 7687)');\n\n        default:\n          throw (0, _error.newError)('Unknown Bolt protocol version: ' + version);\n      }\n    }\n  }]);\n  return ProtocolHandshaker;\n}();\n/**\n * @return {BaseBuffer}\n * @private\n */\n\n\nexports[\"default\"] = ProtocolHandshaker;\n\nfunction newHandshakeBuffer() {\n  var handshakeBuffer = (0, _node.alloc)(5 * 4); // magic preamble\n\n  handshakeBuffer.writeInt32(BOLT_MAGIC_PREAMBLE); // proposed versions\n\n  handshakeBuffer.writeInt32(4);\n  handshakeBuffer.writeInt32(3);\n  handshakeBuffer.writeInt32(2);\n  handshakeBuffer.writeInt32(1); // reset the reader position\n\n  handshakeBuffer.reset();\n  return handshakeBuffer;\n}"]},"metadata":{},"sourceType":"script"}